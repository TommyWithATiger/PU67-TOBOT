# Use this image in production.

FROM tobot/tobot-baseimage

# Move all changes to image
WORKDIR /tobot
COPY . ./

# Install dependencies and build frontend
WORKDIR /tobot/web
RUN node \
  --max_semi_space_size=1 \
  --max_old_space_size=198 \
  --max_executable_size=148
RUN npm install --silent
RUN npm run build
# babel-plugin-transform-runtime node-libs-browser

# Build backend
WORKDIR /tobot
RUN make backend-build
EXPOSE 5032

# Run the backend server
CMD [ "make", "backend-run" ]
